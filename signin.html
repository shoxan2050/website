<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Kirish</title>
  <style>
    /* Oldingi CSS ni saqlang, o'zgartirish shart emas */
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center;
      background: radial-gradient(circle at top, #1e293b, #020617); font-family: "Segoe UI", system-ui, sans-serif; color: #e5e7eb; }
    .card { width: 440px; background: rgba(2, 6, 23, 0.95); padding: 40px; border-radius: 20px;
      box-shadow: 0 30px 90px rgba(0,0,0,.75); }
    h1 { text-align: center; font-size: 32px; margin-bottom: 30px; letter-spacing: 1px; }
    input { width: 100%; padding: 18px 20px; font-size: 20px; margin-bottom: 18px; border-radius: 14px;
      border: 2px solid #334155; background: #020617; color: #e5e7eb; outline: none; }
    input:focus { border-color: #38bdf8; box-shadow: 0 0 0 4px rgba(56,189,248,.25); }
    button { width: 100%; padding: 18px; font-size: 20px; border-radius: 14px; border: none;
      background: linear-gradient(135deg, #38bdf8, #6366f1); color: #020617; font-weight: 700; cursor: pointer; }
    button:hover { opacity: .95; }
    .error { margin-top: 14px; color: #f87171; font-size: 15px; text-align: center; }
    .link { text-align: center; margin-top: 22px; font-size: 15px; }
    .link a { color: #38bdf8; text-decoration: none; }
  </style>
</head>
<body>
<div class="card">
  <h1>Kirish</h1>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Parol">
  <button id="loginBtn">Kirish</button>
  <div id="error" class="error"></div>
  <div class="link">
    Hisob yo‘qmi? <a href="signup.html">Ro‘yxatdan o‘tish</a>
  </div>
</div>

<script type="module">
  import { auth, onAuthStateChanged, signInWithEmailAndPassword } from "./firebase-config.js";

  const errorBox = document.getElementById("error");
  const loginBtn = document.getElementById("loginBtn");

  // Agar allaqachon login bo'lgan bo'lsa → major.html ga
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window.location.href = "major.html";  // major.html = rol tanlash
    }
  });

  loginBtn.onclick = async () => {
    errorBox.textContent = "";
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!email || !password) {
      errorBox.textContent = "Email va parolni to‘ldiring";
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, password);
      // Muvaffaqiyatli bo'lsa avto redirect onAuthStateChanged da bo'ladi
    } catch (e) {
      let msg = "Email yoki parol noto‘g‘ri";
      if (e.code === "auth/invalid-email") msg = "Email noto‘g‘ri";
      if (e.code === "auth/user-not-found") msg = "Bunday foydalanuvchi topilmadi";
      if (e.code === "auth/wrong-password") msg = "Parol noto‘g‘ri";
      if (e.code === "auth/too-many-requests") msg = "Juda ko‘p urinish, keyinroq urining";
      errorBox.textContent = msg;
    }
  };
</script>
</body>
</html>
