<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Ro‘yxatdan o‘tish</title>

<style>
body{
  margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(circle at top,#1e293b,#020617);
  font-family:system-ui;color:#e5e7eb
}
.card{
  width:460px;background:#020617;padding:40px;border-radius:20px;
  box-shadow:0 30px 90px rgba(0,0,0,.7)
}
h1{text-align:center;font-size:30px;margin-bottom:25px}
input{
  width:100%;padding:18px;font-size:20px;margin-bottom:16px;
  border-radius:14px;border:2px solid #334155;background:#020617;color:#fff
}
button{
  width:100%;padding:18px;font-size:20px;border-radius:14px;
  background:linear-gradient(135deg,#38bdf8,#6366f1);
  border:none;font-weight:700;cursor:pointer
}
.error{color:#f87171;text-align:center;margin-top:10px}
.hidden{display:none}
</style>
</head>

<body>

<div class="card">
  <h1 id="title">Ro‘yxatdan o‘tish</h1>

  <!-- STEP 1 -->
  <div id="step1">
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Parol (kamida 6 ta)">
    <button id="createBtn">Davom etish</button>
  </div>

  <!-- STEP 2 -->
  <div id="step2" class="hidden">
    <input id="firstName" placeholder="Ism">
    <input id="lastName" placeholder="Familiya">
    <button id="saveBtn">Saqlash</button>
  </div>

  <div id="error" class="error"></div>
</div>

<script type="module">
import { auth, database } from "./firebase.js";
import {
  createUserWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import {
  ref, set
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

let currentUser;

createBtn.onclick = async () => {
  error.textContent="";
  try{
    const email=email.value.trim();
    const password=password.value;
    if(!email||!password) throw "Email va parolni to‘ldiring";

    const res = await createUserWithEmailAndPassword(auth,email,password);
    currentUser = res.user;

    step1.classList.add("hidden");
    step2.classList.remove("hidden");
    title.textContent="Ma’lumotlaringiz";

  }catch(e){
    error.textContent =
      e.code==="auth/invalid-email" ? "Email noto‘g‘ri" :
      e.code==="auth/email-already-in-use" ? "Bu email mavjud" :
      e.code==="auth/weak-password" ? "Parol kamida 6 ta belgi" :
      "Xatolik yuz berdi";
  }
};

saveBtn.onclick = async () => {
  const fn=firstName.value.trim();
  const ln=lastName.value.trim();
  if(!fn||!ln){ error.textContent="Ism va familiya kerak"; return; }

  await set(ref(database,"users/"+currentUser.uid),{
    firstName:fn,
    lastName:ln,
    role:"unknown",
    created:Date.now()
  });

  location.href="/major.html";
};
</script>

</body>
</html>
